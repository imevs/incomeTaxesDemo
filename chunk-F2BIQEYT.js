import{a as W}from"./chunk-CDGN7OTY.js";import{a as k,b as y}from"./chunk-DDMCPOCP.js";import{Aa as v,Fa as V,Ga as j,Ha as c,Ia as l,Ja as L,Ka as P,La as R,Na as h,Oa as b,Pa as M,Qa as _,Ra as d,Sa as F,Ta as x,V as D,W as m,X as u,Xa as Q,Ya as H,Za as U,bc as w,ec as q,fc as X,jc as Y,ka as s,kc as z,lc as Z,mb as B,oc as $,pc as G,qa as O,qc as E,sc as T,tc as J,uc as f}from"./chunk-5WLU4PN2.js";var ee=["chartjsTooltip"],te=(p,e)=>e.key;function ie(p,e){if(p&1&&(c(0,"option",3),d(1),l()),p&2){let i=e.$implicit;h("value",i.key),s(),F(i.name)}}var K="gross",A=class p{get incomeType(){return K}chartRates;chartjsTooltip;calculationList=[];metrics=k;metricsNameMap=y;metric="effectiveRates.taxRateEmployer";tooltip={rates:"",styles:{top:"0",left:"0"},title:"Rates"};lineChartOptions={locale:"fr",events:["mousedown","mouseup","mousemove","mouseout"],scales:{x:{type:"linear",ticks:{callback:(e,i,t)=>f(e,0,"EUR")}},y:{type:"linear",beginAtZero:!0,ticks:{callback:(e,i,t)=>this.metric.toLowerCase().includes("rate")?e+" %":f(e,0,"EUR")}}},animation:{delay:200,duration:0},interaction:{intersect:!1},elements:{point:{hitRadius:5,hoverRadius:8}},plugins:{tooltip:{enabled:()=>this.metric!=="effectiveRates.taxRateEmployer",external:({tooltip:e,chart:i})=>{if(this.metric!=="effectiveRates.taxRateEmployer")return;let t=i.canvas.getBoundingClientRect();if(e.opacity===0||e.getActiveElements().length===0){this.chartjsTooltip.nativeElement.style.opacity=0;return}let r=e.body[0]?.lines??[];this.tooltip.rates=r[r.length-1]??"",this.tooltip.styles={left:t.left+window.scrollX+e.caretX+"px",top:t.top+window.scrollY+e.caretY+"px"},this.chartjsTooltip.nativeElement.style.opacity=.8},callbacks:{label:e=>{if(this.metric!=="effectiveRates.taxRateEmployer")return;let i=new RegExp(/\((.+)\/(.+)\)/),t=e.dataset.label?.match(i);if(!t)return;let r=t[1],n=t[2],a=this.calculationList.find(o=>o.options.country===r&&o.options.year+""===n),{exchangeRate:N}=E[r],I=T(J(e.label,this.lineChartOptions?.locale),0),C=a?.reports.find(o=>Math.abs(T(o[this.incomeType]/N,0)-I)<1);if(this.tooltip.title=e.dataset.label+": "+e.parsed.y+"% / "+f(I,0,"EUR"),!C)return;let S=Object.entries(C.effectiveRates).filter(([o])=>this.metric!=="effectiveRates."+o);return[e.dataset.label+": "+e.parsed.y].concat(S.map(([o,g])=>y["effectiveRates."+o]+": "+g)).concat(S.map(([o,g])=>y["effectiveRates."+o]+"|"+g+"|"+f(C[`taxes_${o}`]/N,2,"EUR")).join("#"))}}},legend:{display:!0,align:"end"},datalabels:{display:!1}}};ratesChartData={labels:[],datasets:[]};generateLineDataset(e){if(!e)return;let i=e.options.country,t=e.reports,r="("+e.options.country+"/"+e.options.year+")",{exchangeRate:n}=E[i];return{data:t.map(a=>({x:a[this.incomeType]/n,y:this.metric.includes("effectiveRates")?a.effectiveRates[this.metric.split(".")[1]]:this.metric.includes("rates")?a.rates[this.metric.split(".")[1]]:a[this.metric]/n})),label:k.find(a=>a.key===this.metric)?.name+" "+r}}ngOnChanges(e){let i=new URLSearchParams(location.hash.replace("#",""));K=i.get("kind")==="full"?"costForEmployer":i.get("kind"),this.ratesChartData={datasets:this.calculationList.map(t=>this.generateLineDataset(t)).filter(t=>!!t)},this.chartRates?.update()}chartClicked({event:e,active:i}){}chartHovered({event:e,active:i}){}static \u0275fac=function(i){return new(i||p)};static \u0275cmp=O({type:p,selectors:[["income-metrics-comparison"]],viewQuery:function(i,t){if(i&1&&(b(w,5),b(ee,5)),i&2){let r;M(r=_())&&(t.chartRates=r.first),M(r=_())&&(t.chartjsTooltip=r.first)}},inputs:{calculationList:"calculationList"},features:[D],decls:14,vars:8,consts:[["chartjsTooltip",""],["for","metric"],["id","metric",3,"ngModelChange","ngModel"],[3,"value"],["baseChart","",3,"chartHover","chartClick","data","options","type"],[1,"customTooltip",3,"ngStyle"],[3,"percentages","title"]],template:function(i,t){if(i&1){let r=P();c(0,"h2"),d(1,"Tax rates comparison"),l(),c(2,"div")(3,"label",1),d(4,"Select metric: "),l(),c(5,"select",2),U("ngModelChange",function(a){return m(r),H(t.metric,a)||(t.metric=a),u(a)}),R("ngModelChange",function(){return m(r),u(t.ngOnChanges({}))}),V(6,ie,2,2,"option",3,te),l()(),c(8,"div"),d(9),l(),c(10,"canvas",4),R("chartHover",function(a){return m(r),u(t.chartHovered(a))})("chartClick",function(a){return m(r),u(t.chartClicked(a))}),l(),c(11,"div",5,0),L(13,"pie-chart",6),l()}i&2&&(s(5),Q("ngModel",t.metric),s(),j(t.metrics),s(3),x("Compare by: ",t.metricsNameMap[t.incomeType],""),s(),v("data",t.ratesChartData)("options",t.lineChartOptions)("type","line"),s(),v("ngStyle",t.tooltip.styles),s(2),h("percentages",t.tooltip.rates),h("title",t.tooltip.title))},dependencies:[w,G,z,Z,Y,q,$,X,W,B],styles:['.customTooltip[_ngcontent-%COMP%]{position:absolute;opacity:0;transform:translate(-50%,20px);transition:all .2s ease;pointer-events:none}.customTooltip[_ngcontent-%COMP%]:before{content:"";background:#000;opacity:1;width:1em;height:1em;transform:rotate(45deg) translate(-60%);position:absolute;left:50%;z-index:-1}']})};export{A as IncomeMetricsComparisonComponent};
